# Importing the Bluetooth Socket library
import bluetooth
import time
# Importing the GPIO library to use the GPIO pins of Raspberry pi
import RPi.GPIO as GPIO
led_pin = 21	# Initializing pin 40 for led
GPIO.setwarnings(False)
GPIO.setmode(GPIO.BCM)	# Using BCM numbering
GPIO.setup(ledPi uses port 1 for Bluetooth Communication
# Creaitng Socket Bluetooth RFCOMM communication
server = bluetooth.BluetoothSocket(bluetooth.RFCOMM)
print('Bluetooth Socket Created')
try:
	server.bind((host, port))
	print("Bluetooth Binding Completed")
except:
	print("Bluetooth Binding Failed")
server.listen(1) # One connection at a time
# Server accepts the clients request and assigns a mac address. 
client, address = server.accept()
print("Connected To", address)
print("Client:", client)
speed = 5
try:
    
    while(True):
        speed = speed + 5
        client.send("1234");
        client.send(",");
        client.send(str(speed) + "rpm");
        client.send(";");
        time.sleep(0.02)
        # Receivng the data.  
		#data = client.recv(1024) # 1024 is the buffer size.
		#print(data)
		#send_data = "Engine RPM is " + str(data)
		# Sending the data.
        
except:
	# Making all the output pins LOW
	GPIO.cleanup()
	# Closing the client and server connection
	client.close()
	server.close()